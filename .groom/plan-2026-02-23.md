# Grooming Plan — 2026-02-23

## Themes Explored

- **Theme A: Scripting & Automation** → Config files + JSON output + stdin support
- **Theme B: Resilience** → Retry/backoff wiring (half-built infrastructure)
- **Theme C: Discoverability** → `thinktank models` subcommand + dynamic help text
- **Theme D: Code Health** → Long function decomposition + legacy field removal + coverage gaps

## Issues Created

| # | Title | Priority | Effort | Score |
|---|-------|----------|--------|-------|
| [#214](https://github.com/misty-step/thinktank/issues/214) | Add retry/backoff for transient model failures | P1/now | S | 90+ |
| [#215](https://github.com/misty-step/thinktank/issues/215) | Add config file support (~/.thinktankrc) | P2/next | M | 90+ |
| [#216](https://github.com/misty-step/thinktank/issues/216) | Add --output-format json | P2/next | S | 90+ |
| [#217](https://github.com/misty-step/thinktank/issues/217) | Support stdin for instructions | P2/next | S | 90+ |
| [#218](https://github.com/misty-step/thinktank/issues/218) | Add `thinktank models` subcommand | P2/next | S | 90+ |
| [#219](https://github.com/misty-step/thinktank/issues/219) | Dynamic model list in help text | P2/next | S | 90+ |
| [#220](https://github.com/misty-step/thinktank/issues/220) | Decompose handleProcessingOutcome + runApplication | P3/later | S | 85+ |
| [#221](https://github.com/misty-step/thinktank/issues/221) | Deprecate legacy OpenAI/Gemini rate limit fields | P3/later | S | 85+ |
| [#222](https://github.com/misty-step/thinktank/issues/222) | Close coverage gaps in 3 packages | P3/later | S | 85+ |

## Deferred

- **Shell completion**: Hand-rolled parser makes this non-trivial. Revisit if cobra/urfave is ever adopted.
- **Cost metadata on models**: Requires ongoing maintenance of pricing data. Revisit if cost awareness becomes a user request.
- **Model presets/profiles**: Covered by config file (#215) — users can define model lists there.
- **Result diffing**: Unique differentiator but significant effort. Revisit post-v4.

## Research Findings

### Config File Approach
- Slot in `main.go` between `ParseSimpleArgs()` (line 56) and `setupConfiguration()` (line 71)
- YAML via `gopkg.in/yaml.v3` (already in go.mod)
- Load order: `--config-file` flag > `$THINKTANK_CONFIG` env var > `~/.thinktankrc`
- CLI-only fields (never in config): `InstructionsFile`, `TargetPaths`, `OutputDir`

### Retry Infrastructure
- `RecoveryInformation.RetryPossible` and `EstimatedWaitTime` already populated but never read
- `ExtractRecoveryInformation()` at `internal/llm/errors.go:712-764` — just call it
- Insertion point: `processor.go:142` — extract into `generateContentWithRetry()`
- ~50 lines, zero new dependencies

### Model Subcommand
- Hand-rolled parser in `simple_parser.go` — add subcommand detection before normal arg parsing
- `models.GetCoreCouncilModels()` and full model definitions already exposed
- Show: ID, provider, context window, council marker

## Retro Patterns Applied

First grooming session — no retro data. Will populate after implementations.
